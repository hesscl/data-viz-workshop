<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Case B: Describing trends in DD and event study designs</title>

<script src="site_libs/header-attrs-2.13/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/lumen.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Purposeful Plotting</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
    Home
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fa fa-chart-line"></span>
     
    Case Studies
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="case-a-covariate-balance.html">Case A: Covariate Balance</a>
    </li>
    <li>
      <a href="case-b-event-study.html">Case B: Event Studies</a>
    </li>
    <li>
      <a href="case-c-spatial-distribution.html">Case C: Spatial Distribution</a>
    </li>
    <li>
      <a href="case-d-multiple-contrasts.html">Case D: Multiple Contrasts</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fa fa-info"></span>
     
    Resources
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="resources-ggplot.html">ggplot</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Case B: Describing trends in DD and event study designs</h1>

</div>


<p><br></p>
<div id="introduction-about-design-based-studies" class="section level2">
<h2>Introduction about design-based studies</h2>
<p>Another case where data visualizations can be of particular utility is in the context of describing average levels or change over time in a design-based study of some type.</p>
<p><br></p>
<div id="motivation-how-to-effectively-convey-change-parallel-trends-and-treatment-heterogeneity" class="section level3">
<h3>Motivation: how to effectively convey change, parallel trends and treatment heterogeneity</h3>
<p>There are a few big reasons why it is useful to use visualizations within this type of research design and analysis.</p>
<p>First, these methods depend on change over time for estimating average treatment effects on the treated. Describing change over time is one of the most common uses of data visualization, with a line plot being perhaps the most commonly employed option. So to start, this is a context where we don’t have to be as worried about figures being unexpected or likely to perplex readers.</p>
<p>Second, if relevant, the parallel trends assumption is something that we’d like to assuage reviewers’ and readers’ concerns about and it turns out that we can fold empirical tests related to this assumption into our visualizations quite easily. We don’t always have the capability to test for anticipatory effects pre-treatment, but when we do this is no doubt an important element to why visualizations are effective for difference-in-difference or event study designs.</p>
<p>Third, if relevant, we want to be able to illustrate treatment heterogeneity based on groups having different starting points to their treatment as well differences in length of exposure. Such heterogeneity can become difficult to assess in tabular forms, which may be less true of relatively simple DD designs, but with the use of visualizations, things like group-time specific average treatment effects can be more intuitive.</p>
<p><br></p>
</div>
<div id="how-do-we-get-there" class="section level3">
<h3>How do we get there?</h3>
<p>We will be focusing on making plots that visualize either trends over time for the treated and control groups of a design based study, or just the difference in trends between these two focal groups.</p>
<p>For relatively simple designs, it’s straightforward to estimate the models and make predictions using the <code>fixest</code> library, which handles incorporating fixed effects and clustering errors quite conveniently. However, once we move towards more complex designs where we model treatment heterogeneity and dynamic treatment effects, in such cases there is a very useful package called <code>did</code> that provides a convenient means for estimating these models.</p>
<p><br></p>
</div>
</div>
<div id="setup" class="section level2">
<h2>Setup</h2>
<div id="software-dependencies" class="section level3">
<h3>Software dependencies</h3>
<pre class="r"><code>library(tidyverse)   #dplyr, ggplot2</code></pre>
<pre><code>## ── Attaching packages ─────────────────────────────────────── tidyverse 1.3.1 ──</code></pre>
<pre><code>## ✓ ggplot2 3.3.5     ✓ purrr   0.3.4
## ✓ tibble  3.1.6     ✓ dplyr   1.0.8
## ✓ tidyr   1.2.0     ✓ stringr 1.4.0
## ✓ readr   2.1.2     ✓ forcats 0.5.1</code></pre>
<pre><code>## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()</code></pre>
<pre class="r"><code>library(fixest)      #for simpler DD models
library(did)         #for event study models</code></pre>
<p><br></p>
</div>
</div>
<div id="data" class="section level2">
<h2>Data</h2>
<div id="fake-two-period-dd-data" class="section level3">
<h3>Fake two-period DD data</h3>
<pre class="r"><code>#first let&#39;s simulate some simple two period DD data to model
set.seed(20220418)

#make the 2 period data
sim_2_period_param &lt;- reset.sim(time.periods = 2)
sim_2_period &lt;- build_sim_dataset(sim_2_period_param)

#look at the simulated data
glimpse(sim_2_period)</code></pre>
<pre><code>## Rows: 6,816
## Columns: 7
## $ G       &lt;dbl&gt; 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,…
## $ X       &lt;dbl&gt; 0.3252394, 0.3252394, -0.2484243, -0.2484243, 0.2038793, 0.203…
## $ id      &lt;int&gt; 1, 1, 2, 2, 4, 4, 7, 7, 8, 8, 10, 10, 13, 13, 15, 15, 17, 17, …
## $ cluster &lt;int&gt; 15, 15, 23, 23, 6, 6, 49, 49, 3, 3, 20, 20, 25, 25, 13, 13, 49…
## $ period  &lt;dbl&gt; 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1,…
## $ Y       &lt;dbl&gt; 3.0012710, 5.3261926, 2.4214177, 2.9075177, 3.0204852, 5.21777…
## $ treat   &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…</code></pre>
<p><br></p>
</div>
<div id="real-world-event-study-data" class="section level3">
<h3>Real-world event study data</h3>
<p>The other data that we will look at are from a recent study about using difference-in-difference designs where there are multiple tiem periods of observation and treatment heterogeneity among the group receiving the intervention. These data are a strongly-balanced panel covering 500 U.S. counties observed across 5 time periods (2003-2007). The study these data are drawn from analyzes the effect of minimum wage policies on teen employment, and since the laws were passed at different times there is a need for an event study design that considers these differences in exposure timing and length.</p>
<blockquote>
<p>Callaway, B., &amp; Sant’Anna, P. H. (2021). Difference-in-differences with multiple time periods. Journal of Econometrics, 225(2), 200-230.</p>
</blockquote>
<pre class="r"><code>mpdta &lt;- read_csv(&quot;./data/mpdata.csv&quot;)</code></pre>
<pre><code>## Rows: 2500 Columns: 6
## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## dbl (6): year, countyreal, lpop, lemp, first.treat, treat
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<pre class="r"><code>glimpse(mpdta)</code></pre>
<pre><code>## Rows: 2,500
## Columns: 6
## $ year        &lt;dbl&gt; 2003, 2004, 2005, 2006, 2007, 2003, 2004, 2005, 2006, 2007…
## $ countyreal  &lt;dbl&gt; 8001, 8001, 8001, 8001, 8001, 8019, 8019, 8019, 8019, 8019…
## $ lpop        &lt;dbl&gt; 5.896761, 5.896761, 5.896761, 5.896761, 5.896761, 2.232377…
## $ lemp        &lt;dbl&gt; 8.461469, 8.336870, 8.340217, 8.378161, 8.487352, 4.997212…
## $ first.treat &lt;dbl&gt; 2007, 2007, 2007, 2007, 2007, 2007, 2007, 2007, 2007, 2007…
## $ treat       &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…</code></pre>
<p><br></p>
<div id="dependent-variable" class="section level4">
<h4>Dependent variable</h4>
<p>The outcome is the log of teen employment from 2004 to 2007, taken from the Quarterly Workforce Indicators (QWI).</p>
<pre class="r"><code>summary(mpdta$lemp)</code></pre>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##   1.099   4.868   5.697   5.773   6.684  10.443</code></pre>
<p><br></p>
</div>
</div>
</div>
<div id="what-are-the-trends-over-time" class="section level2">
<h2>What are the trends over time?</h2>
<div id="two-period" class="section level3">
<h3>Two period</h3>
<p>Starting with the simulated 2 period data, this sort of plot is probably the most common for two period data.</p>
<pre class="r"><code>#summarize the mean values before and after treatment
dd_2_period &lt;- sim_2_period %&gt;%
  group_by(period, treat) %&gt;%
  summarize(mean_Y = mean(Y))</code></pre>
<pre><code>## `summarise()` has grouped output by &#39;period&#39;. You can override using the
## `.groups` argument.</code></pre>
<pre class="r"><code>ggplot(dd_2_period, aes(x = period, y = mean_Y, shape = factor(treat), group = treat)) +
  geom_line() +
  geom_point(size = 2)</code></pre>
<p><img src="case-b-event-study_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p><br></p>
<p>In some instances you see a counterfactual line added to denote what we expect the post treatment value to be under the assumptions of the DD model, and this can be added relatively easily.</p>
<pre class="r"><code>dd_2_period &lt;- dd_2_period %&gt;%
  group_by(treat) %&gt;%
  mutate(chg = mean_Y[period == 2] - mean_Y[period == 1]) %&gt;%
  ungroup() %&gt;%
  mutate(cf = ifelse(period == 1, mean_Y, mean_Y[period == 1] + chg[treat == 0]))

ggplot(dd_2_period, aes(x = period, y = mean_Y, shape = factor(treat), 
                        group = treat, linetype = &quot;Observed&quot;)) +
  geom_line() +
  geom_line(aes(x = period, y = cf, linetype = &quot;Counterfactual&quot;)) +
  geom_point(aes(x = period, y = cf), size = 2.5) +
  geom_point(size = 3) +
  scale_x_continuous(breaks = c(1, 2), labels = c(&quot;Pre-treatment&quot;, &quot;Post-treatment&quot;)) +
  scale_shape_discrete(labels = c(&quot;Control&quot;, &quot;Treated&quot;)) +
  scale_linetype_manual(values = c(2, 1)) +
  labs(x = &quot;&quot;, y = &quot;Average Y\n&quot;, shape = &quot;&quot;, linetype = &quot;&quot;) +
  theme_bw() +
  theme(panel.grid.minor = element_blank(), 
        panel.grid.major.x = element_blank())</code></pre>
<p><img src="case-b-event-study_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p><br></p>
</div>
<div id="multiple-periods" class="section level3">
<h3>Multiple periods</h3>
<p>This sort of visualization extends to the use case of having multiple time periods, with the important assumption that the treatment timing is still uniform across groups.</p>
<p>To demonstrate this, here we visualize the multiple-period <code>mpdta</code> using only the control cases and cases where treatment began in 2006. This is obviously just for demonstration and we wouldn’t throw out the other cases in practice, but it’s fairly clear what is going on in this plot.</p>
<p>Still, since the trends are relatively muted compared to difference in level over time, this is a case where we might start to prefer a plot looking just at the difference in trends between the two groups at each of the periods. This would help to scale the y-axis such that the changes are more perceptible, though as it stands right now the change in trends starting with treatment is still pretty easy to see.</p>
<pre class="r"><code>means &lt;- mpdta %&gt;%
  filter(first.treat %in% c(2006, 0)) %&gt;%
  group_by(year, treat) %&gt;%
  summarize(lemp = mean(lemp))</code></pre>
<pre><code>## `summarise()` has grouped output by &#39;year&#39;. You can override using the
## `.groups` argument.</code></pre>
<pre class="r"><code>ggplot(means, aes(x = year, y = lemp, group = treat, shape = factor(treat))) +
  geom_vline(xintercept = 2006) +
  geom_line() +
  geom_point(size = 2.5) +
  scale_shape_discrete(labels = c(&quot;Control&quot;, &quot;Treated&quot;)) +
  theme_bw() +
  theme(legend.position = &quot;bottom&quot;, 
        panel.grid.minor = element_blank()) +
  labs(x = &quot;&quot;, y = &quot;Logged Teen Employment\n&quot;, shape = &quot;&quot;)</code></pre>
<p><img src="case-b-event-study_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p><br></p>
<p>In contrast, with treatment timing we have to retool things a bit. The result is not quite as simple since the small multiples are needed, but by overlaying the control group in each panel it is easier to make the implied comparison than if we had a separate panel for those cases.</p>
<pre class="r"><code>means &lt;- mpdta %&gt;%
  group_by(year, first.treat, treat) %&gt;%
  summarize(lemp = mean(lemp)) %&gt;%
  ungroup() %&gt;%
  mutate(first.treat = ifelse(first.treat == 0, NA, first.treat)) %&gt;%
  rowwise() %&gt;%
  mutate(first.treat.chr = case_when(
           is.na(first.treat) ~ list(c(2004, 2006, 2007)), 
           TRUE ~ list(unique(first.treat)))) %&gt;%
  ungroup() %&gt;%
  unnest(first.treat.chr)</code></pre>
<pre><code>## `summarise()` has grouped output by &#39;year&#39;, &#39;first.treat&#39;. You can override
## using the `.groups` argument.</code></pre>
<pre class="r"><code>ggplot(means, aes(x = year, y = lemp, 
                  shape = factor(first.treat), linetype = is.na(first.treat),
                  group = factor(first.treat))) +
  facet_wrap(~ paste(&quot;First Treated:&quot;, first.treat.chr)) +
  geom_vline(aes(xintercept = first.treat)) +
  geom_line() +
  geom_point() +
  geom_point() +
  scale_linetype_discrete(labels = c(&quot;Treated&quot;, &quot;Control&quot;)) +
  scale_shape_discrete(na.value = 4, labels = c(&quot;2004&quot;, &quot;2006&quot;, &quot;2007&quot;, &quot;Control&quot;)) +
  theme_bw() +
  theme(legend.position = &quot;bottom&quot;,
        panel.spacing = unit(.2, &quot;in&quot;),
        panel.grid.minor = element_blank()) +
  labs(x = &quot;&quot;, y = &quot;Logged Teen Employment\n&quot;, linetype = &quot;Treatment Group&quot;) +
  guides(shape = &quot;none&quot;)</code></pre>
<pre><code>## Warning: Removed 15 rows containing missing values (geom_vline).</code></pre>
<p><img src="case-b-event-study_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p><br></p>
</div>
</div>
<div id="what-are-the-average-treatment-effects" class="section level2">
<h2>What are the average treatment effects?</h2>
<div id="two-time-periods" class="section level3">
<h3>Two time periods</h3>
<p>Since a two period design produces a single estimate for the ATT, this is really a case where graphics don’t offer much beyond conveying this information through a table.</p>
<p><br></p>
</div>
<div id="multiple-time-periods" class="section level3">
<h3>Multiple time periods</h3>
<p>Nonetheless, in instances where we have greater complexity to the study design, a figure illustrating the average treatment effects–whether group-time specific or averaged over these groups–can be useful.</p>
<p>Following the vignette from the <code>did</code> package website, we can use the following code to estimate the group-time average treatment effects without covariates.</p>
<pre class="r"><code># estimate group-time average treatment effects without covariates
mw.attgt &lt;- att_gt(yname = &quot;lemp&quot;,
                   gname = &quot;first.treat&quot;,
                   idname = &quot;countyreal&quot;,
                   tname = &quot;year&quot;,
                   xformla = ~ 1,
                   data = mpdta,
                   )

# summarize the results
summary(mw.attgt) </code></pre>
<pre><code>## 
## Call:
## att_gt(yname = &quot;lemp&quot;, tname = &quot;year&quot;, idname = &quot;countyreal&quot;, 
##     gname = &quot;first.treat&quot;, xformla = ~1, data = mpdta)
## 
## Reference: Callaway, Brantly and Pedro H.C. Sant&#39;Anna.  &quot;Difference-in-Differences with Multiple Time Periods.&quot; Journal of Econometrics, Vol. 225, No. 2, pp. 200-230, 2021. &lt;https://doi.org/10.1016/j.jeconom.2020.12.001&gt;, &lt;https://arxiv.org/abs/1803.09015&gt; 
## 
## Group-Time Average Treatment Effects:
##  Group Time ATT(g,t) Std. Error [95% Simult.  Conf. Band]  
##   2004 2004  -0.0105     0.0243       -0.0777      0.0567  
##   2004 2005  -0.0704     0.0328       -0.1612      0.0204  
##   2004 2006  -0.1373     0.0403       -0.2487     -0.0258 *
##   2004 2007  -0.1008     0.0341       -0.1952     -0.0064 *
##   2006 2004   0.0065     0.0235       -0.0585      0.0716  
##   2006 2005  -0.0028     0.0188       -0.0548      0.0493  
##   2006 2006  -0.0046     0.0181       -0.0548      0.0456  
##   2006 2007  -0.0412     0.0208       -0.0988      0.0164  
##   2007 2004   0.0305     0.0145       -0.0096      0.0706  
##   2007 2005  -0.0027     0.0160       -0.0470      0.0416  
##   2007 2006  -0.0311     0.0181       -0.0812      0.0190  
##   2007 2007  -0.0261     0.0163       -0.0713      0.0191  
## ---
## Signif. codes: `*&#39; confidence band does not cover 0
## 
## P-value for pre-test of parallel trends assumption:  0.16812
## Control Group:  Never Treated,  Anticipation Periods:  0
## Estimation Method:  Doubly Robust</code></pre>
<p><br></p>
<p>There is a default plot method for the <code>did</code> package that enables you to avoid making the plot for yourself.</p>
<pre class="r"><code># plot the results
# set ylim so that all plots have the same scale along y-axis
ggdid(mw.attgt, ylim = c(-.3, .3), type = &quot;calendar&quot;)</code></pre>
<p><img src="case-b-event-study_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<p><br></p>
</div>
<div id="a-note-about-using-color-in-figures" class="section level3">
<h3>A note about using color in figures</h3>
<p>There are some accessibility issues with the default plot that may motivate modifications. Most important is that the default ggplot red and blue colors collapse to very similar shades of gray when printed in black and white. This is emblematic of a general problem that has to be grappled with when producing visualizations for published research articles.</p>
<p>See the interpretability of the figure (cropped for size) from the Callaway and Sant’anna (2021) article in color:</p>
<p><img src="etc/callaway-fig.jpg" /></p>
<p>Compared to in grayscale:</p>
<p><img src="etc/callaway-fig-bw.jpg" /></p>
<p><br></p>
<p>It’s not impossible, but takes a lot more scrutiny to see the residual differences in shade once the blue and red hues are taken away.</p>
<p>While you do occasionally see folks punt and add a “you need to be looking at a PDF to see the color version and only this color version makes sense” caption to figures in an article, this is a case where we can easily make a change to have a color rich version for digital viewers, but a still comprehensible solution for print viewers.</p>
<p><em>Enter:</em> <code>viridis</code>. You have probably already seen this palette in use and maybe you are even already a user yourself, but for any who are not familiar this is a wonderful tool for effective data visualization with color. All variations on the color palette change in their hue (i.e. RGB values) but also <em>value</em> (grayscale). This means that, by default, the colors flatten to grays that should still perceptibly differ. Using discrete or binned values is a surefire way to ensure this is the case, since 4 or 5 levels of gray tend to be reasonably decipherable.</p>
<p>Thankfully, you can also pass <code>theming = FALSE</code> to <code>ggdid()</code> to have it produce an ATT plot but let you handle the theming yourself. There does not seem to be an easy way to manipulate the aesthetics of this plot (e.g., add a shape aesthetic for pre/post), unfortuantely, but you can make some useful modifications to your liking.</p>
<pre class="r"><code># plot the results
# set ylim so that all plots have the same scale along y-axis
ggdid(mw.attgt, ylim = c(-.3, .3), type = &quot;calendar&quot;, theming = FALSE) +
  scale_color_viridis_d(begin = .75, end = .25, labels = c(&quot;Pre-treatment&quot;, &quot;Post-treatment&quot;)) +
  theme_bw() +
  theme(legend.position = &quot;bottom&quot;) +
  labs(title = &quot;&quot;, subtitle = &quot;&quot;)</code></pre>
<pre><code>## Scale for &#39;colour&#39; is already present. Adding another scale for &#39;colour&#39;,
## which will replace the existing scale.</code></pre>
<p><img src="case-b-event-study_files/figure-html/unnamed-chunk-11-1.png" width="576" /></p>
<p><br></p>
<p>and, what would folks viewing our figure in print see?</p>
<p><img src="etc/mpdta-plot-bw.png" id="id" class="class" style="width:65.0%;height:65.0%" /></p>
<p><br></p>
</div>
</div>
<div id="how-do-the-treatment-effects-vary-by-length-of-exposure" class="section level2">
<h2>How do the treatment effects vary by length of exposure?</h2>
<pre class="r"><code>#aggregate the group-time average treatment effects
mw.dyn &lt;- aggte(mw.attgt, type = &quot;dynamic&quot;)

#print the summary output
summary(mw.dyn)</code></pre>
<pre><code>## 
## Call:
## aggte(MP = mw.attgt, type = &quot;dynamic&quot;)
## 
## Reference: Callaway, Brantly and Pedro H.C. Sant&#39;Anna.  &quot;Difference-in-Differences with Multiple Time Periods.&quot; Journal of Econometrics, Vol. 225, No. 2, pp. 200-230, 2021. &lt;https://doi.org/10.1016/j.jeconom.2020.12.001&gt;, &lt;https://arxiv.org/abs/1803.09015&gt; 
## 
## 
## Overall summary of ATT&#39;s based on event-study/dynamic aggregation:  
##      ATT    Std. Error     [ 95%  Conf. Int.]  
##  -0.0772        0.0204    -0.1173     -0.0372 *
## 
## 
## Dynamic Effects:
##  Event time Estimate Std. Error [95% Simult.  Conf. Band]  
##          -3   0.0305     0.0142       -0.0044      0.0654  
##          -2  -0.0006     0.0136       -0.0340      0.0328  
##          -1  -0.0245     0.0145       -0.0600      0.0111  
##           0  -0.0199     0.0122       -0.0500      0.0101  
##           1  -0.0510     0.0172       -0.0933     -0.0086 *
##           2  -0.1373     0.0385       -0.2318     -0.0427 *
##           3  -0.1008     0.0358       -0.1888     -0.0128 *
## ---
## Signif. codes: `*&#39; confidence band does not cover 0
## 
## Control Group:  Never Treated,  Anticipation Periods:  0
## Estimation Method:  Doubly Robust</code></pre>
<pre class="r"><code>#use the default plot method
ggdid(mw.dyn, ylim = c(-.3, .3))</code></pre>
<p><img src="case-b-event-study_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<p><br></p>
<pre class="r"><code># plot the results
# set ylim so that all plots have the same scale along y-axis
ggdid(mw.dyn, ylim = c(-.3, .3), type = &quot;dynamic&quot;, theming = FALSE) +
  scale_color_viridis_d(begin = .75, end = .25, labels = c(&quot;Pre-treatment&quot;, &quot;Post-treatment&quot;)) +
  theme_bw() +
  theme(legend.position = &quot;bottom&quot;) +
  labs(title = &quot;&quot;, subtitle = &quot;&quot;)</code></pre>
<pre><code>## Scale for &#39;colour&#39; is already present. Adding another scale for &#39;colour&#39;,
## which will replace the existing scale.</code></pre>
<p><img src="case-b-event-study_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<p><br></p>
</div>
<div id="hands-on-use-the-injury-data-or-your-own-data-to-make-graphics-for-trends-over-time." class="section level2">
<h2>Hands-on: Use the <code>injury</code> data or your own data to make graphics for trends over time.</h2>
<pre class="r"><code>injury &lt;- read_csv(&quot;./data/injury.csv&quot;)</code></pre>
<pre><code>## Rows: 7150 Columns: 30
## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## dbl (30): durat, afchnge, highearn, male, married, hosp, indust, injtype, ag...
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<pre class="r"><code>glimpse(injury)</code></pre>
<pre><code>## Rows: 7,150
## Columns: 30
## $ durat    &lt;dbl&gt; 1, 1, 84, 4, 1, 1, 7, 2, 175, 60, 29, 30, 100, 4, 2, 1, 1, 2,…
## $ afchnge  &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…
## $ highearn &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…
## $ male     &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1…
## $ married  &lt;dbl&gt; 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1…
## $ hosp     &lt;dbl&gt; 1, 0, 1, 1, 0, 0, 0, 1, 1, 1, 0, 1, 1, 0, 0, 0, 0, 0, 1, 1, 0…
## $ indust   &lt;dbl&gt; 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 1, 1…
## $ injtype  &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…
## $ age      &lt;dbl&gt; 26, 31, 37, 31, 23, 34, 35, 45, 41, 33, 35, 25, 39, 27, 24, 2…
## $ prewage  &lt;dbl&gt; 404.9500, 643.8250, 398.1250, 527.8000, 528.9375, 614.2500, 5…
## $ totmed   &lt;dbl&gt; 1187.57324, 361.07855, 8963.65723, 1099.64832, 372.80188, 211…
## $ injdes   &lt;dbl&gt; 1010, 1404, 1032, 1940, 1940, 1425, 1110, 1207, 1425, 1010, 1…
## $ benefit  &lt;dbl&gt; 246.8375, 246.8375, 246.8375, 246.8375, 211.5750, 176.3125, 2…
## $ ky       &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…
## $ mi       &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
## $ ldurat   &lt;dbl&gt; 0.0000000, 0.0000000, 4.4308167, 1.3862944, 0.0000000, 0.0000…
## $ afhigh   &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…
## $ lprewage &lt;dbl&gt; 6.003764, 6.467427, 5.986766, 6.268717, 6.270870, 6.420402, 6…
## $ lage     &lt;dbl&gt; 3.258096, 3.433987, 3.610918, 3.433987, 3.135494, 3.526361, 3…
## $ ltotmed  &lt;dbl&gt; 7.079667, 5.889095, 9.100934, 7.002746, 5.921047, 5.351953, 4…
## $ head     &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…
## $ neck     &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
## $ upextr   &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
## $ trunk    &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
## $ lowback  &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
## $ lowextr  &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
## $ occdis   &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
## $ manuf    &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1…
## $ construc &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
## $ highlpre &lt;dbl&gt; 6.003764, 6.467427, 5.986766, 6.268717, 6.270870, 6.420402, 6…</code></pre>
<p><br></p>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
